# ========================================
# üêû ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á Deploy ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 8 (Fix Git & Seed)
# ========================================
# ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÅ‡∏Å‡πâ Git Conflict ‡πÅ‡∏•‡∏∞ Run Seed
# ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:
# 1. Force Reset Git ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Conflict
# 2. Pull ‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ó‡∏µ‡πà‡∏°‡∏µ Seed config ‡πÉ‡∏ô prisma.config.ts)
# 3. ‡∏£‡∏±‡∏ô Seed

bash << 'DEPLOYEOF'
#!/bin/bash
set -e

echo "=========================================="
echo "üêû Deploy ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 8 - Fix Conflict & Seed"
echo "=========================================="

echo ""
echo "üîß [1/4] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Git Conflict..."
cd /var/www/lottery
# Discard local changes (‡πÄ‡∏ä‡πà‡∏ô package.json ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏õ)
git reset --hard origin/main
git pull origin main

echo ""
echo "üì¶ [2/4] ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."
cd apps/api
# ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ ts-node ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô seed
npm install -D ts-node typescript

echo ""
echo "üå± [3/4] ‡∏Å‡∏≥‡∏•‡∏±‡∏á Seed ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..."
# ‡∏™‡∏±‡πà‡∏á Seed ‡∏ú‡πà‡∏≤‡∏ô Prisma (‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô config ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á)
npx prisma db seed

echo ""
echo "üöÄ [4/4] ‡∏Å‡∏≥‡∏•‡∏±‡∏á Restart Services..."
pm2 restart lottery-api --update-env

echo ""
echo "‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô! ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö"
DEPLOYEOF
