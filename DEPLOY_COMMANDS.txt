# üöÄ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Deploy ‡πÅ‡∏ö‡∏ö Copy-Paste ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
# ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡πÉ‡∏ô Terminal ‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1: SSH ‡πÄ‡∏Ç‡πâ‡∏≤ Server
## ===============================================
# ‡πÄ‡∏õ‡∏¥‡∏î PowerShell ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô:
ssh root@76.13.18.170
# Password: bcgAxlDCfwC?yv)FY3&A

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2: Setup Server (‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
## ===============================================
# ‡∏´‡∏•‡∏±‡∏á SSH ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏á:

# ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏∞‡∏ö‡∏ö
apt update && apt upgrade -y

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PM2
npm install -g pm2

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á PostgreSQL
apt install -y postgresql postgresql-contrib
systemctl start postgresql
systemctl enable postgresql

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Database
sudo -u postgres psql << EOF
CREATE DATABASE lottery_db;
CREATE USER lottery_user WITH ENCRYPTED PASSWORD 'L0ttery@2024!Strong';
GRANT ALL PRIVILEGES ON DATABASE lottery_db TO lottery_user;
ALTER DATABASE lottery_db OWNER TO lottery_user;
\q
EOF

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Nginx
apt install -y nginx
systemctl start nginx
systemctl enable nginx

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Git
apt install -y git

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Certbot (SSL)
apt install -y certbot python3-certbot-nginx

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
mkdir -p /var/www/lottery

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firewall
ufw allow OpenSSH
ufw allow 'Nginx Full'
ufw --force enable

echo "‚úÖ Setup Server ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!"

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î (‡πÉ‡∏ä‡πâ FileZilla)
## ===============================================
# 1. Download FileZilla: https://filezilla-project.org
# 2. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ SFTP:
#    Host: sftp://76.13.18.170
#    Username: root
#    Password: bcgAxlDCfwC?yv)FY3&A
#    Port: 22
# 3. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏õ: /var/www/lottery

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .env
## ===============================================
# ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ SSH ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô:

cat > /var/www/lottery/apps/api/.env << 'EOF'
# Database
DATABASE_URL="postgresql://lottery_user:L0ttery@2024!Strong@localhost:5432/lottery_db?schema=public"

# Application
PORT=3001
NODE_ENV=production

# JWT
JWT_SECRET=abcdef1234567890abcdef1234567890abcdef1234567890

# Tweasy Payment
TWEASY_API_URL=https://api.tweasy.com/v1
TWEASY_API_KEY=your_real_tweasy_api_key
TWEASY_SECRET_KEY=your_real_tweasy_secret_key

# URLs
FRONTEND_URL=http://76.13.18.170
API_URL=http://76.13.18.170/api

# Cloudinary (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ)
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
EOF

echo "‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå .env ‡πÄ‡∏™‡∏£‡πá‡∏à!"

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5: Build ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
## ===============================================
cd /var/www/lottery

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies
npm install

# Backend
cd apps/api
npx prisma migrate deploy
npx prisma generate
npm run build

# Frontend
cd ../web
npm run build

echo "‚úÖ Build ‡πÄ‡∏™‡∏£‡πá‡∏à!"

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 6: Run ‡∏î‡πâ‡∏ß‡∏¢ PM2
## ===============================================
# Backend
cd /var/www/lottery/apps/api
pm2 start dist/main.js --name lottery-api

# Frontend
cd /var/www/lottery/apps/web
pm2 start npm --name lottery-web -- start

# ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
pm2 save
pm2 startup

# ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
pm2 list

echo "‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô services ‡πÄ‡∏™‡∏£‡πá‡∏à!"

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 7: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Nginx
## ===============================================
cat > /etc/nginx/sites-available/lottery << 'EOF'
server {
    listen 80;
    server_name 76.13.18.170 srv1269924.hstgr.cloud;

    # Frontend
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_cache_bypass $http_upgrade;
    }

    # Backend API
    location /api {
        rewrite ^/api(.*)$ $1 break;
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # Payment webhooks
    location /payment/ {
        proxy_pass http://localhost:3001/payment/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
EOF

# ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
ln -s /etc/nginx/sites-available/lottery /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx

echo "‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Nginx ‡πÄ‡∏™‡∏£‡πá‡∏à!"

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 8: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö
## ===============================================
echo ""
echo "========================================="
echo "‚úÖ Deploy ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå!"
echo "========================================="
echo ""
echo "üåê ‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà:"
echo "   http://76.13.18.170"
echo ""
echo "üìä ‡∏î‡∏π Logs:"
echo "   pm2 logs lottery-api"
echo "   pm2 logs lottery-web"
echo ""
echo "üîÑ Restart Services:"
echo "   pm2 restart all"
echo ""

## ===============================================
## ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 9: ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á SSL (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Domain)
## ===============================================
# ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ domain ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏ä‡πà‡∏ô lottery.com):
# certbot --nginx -d lottery.com -d www.lottery.com
