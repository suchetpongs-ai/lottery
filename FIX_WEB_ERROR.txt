# ========================================
# üîß FIX lottery-web ERROR
# ========================================
# Copy-paste ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏ö‡∏ô VPS
# ========================================

# STEP 1: ‡∏î‡∏π Error Logs
pm2 logs lottery-web --lines 50 --nostream

# STEP 2: Stop lottery-web
pm2 delete lottery-web

# STEP 3: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Build
cd /var/www/lottery/apps/web
ls -la .next

# STEP 4: Clean ‡πÅ‡∏•‡∏∞ Build ‡πÉ‡∏´‡∏°‡πà
cd /var/www/lottery/apps/web
rm -rf .next node_modules/.cache

# Build ‡πÉ‡∏´‡∏°‡πà
npm run build

# STEP 5: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Build ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
ls -la .next
# ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô folder .next

# STEP 6: Start lottery-web ‡πÉ‡∏´‡∏°‡πà
cd /var/www/lottery/apps/web
pm2 start npm --name lottery-web -- start

# STEP 7: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
pm2 list

# STEP 8: ‡∏î‡∏π Logs ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
pm2 logs lottery-web --lines 20 --nostream

# STEP 9: Save PM2 config
pm2 save

# ========================================
# ‚úÖ Verification
# ========================================
echo "Checking services..."
pm2 list

echo "Testing website..."
curl http://localhost:3000

# ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏•‡∏≠‡∏á restart ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:
# pm2 restart all
# pm2 logs --lines 50

# ========================================
# üåê Open browser and test
# ========================================
# http://76.13.18.170
